<project default="build"
         xmlns:ant="jelly:ant"
         xmlns:util="jelly:util"
         xmlns:j="jelly:core">

    <!-- ==================================================================
            Builds all documentation
         ================================================================== -->
    <goal name="build">
        <attainGoal name="multiproject:site"/>
        <attainGoal name="add-style"/>
        <j:set var="samples.dir" value="${basedir}/../samples"/>
        <!-- copy the animal-quiz model into the resources directory -->
        <ant:copy file="${samples.dir}/animal-quiz/mda/src/uml/AnimalQuiz.xml.zip" todir="${maven.docs.dest}/resources"/>
        <!-- copy the car-rental-system model into the resources directory -->
        <ant:copy file="${samples.dir}/car-rental-system/mda/src/uml/CarRentalSystem.zuml" todir="${maven.docs.dest}/resources"/>
        <!-- unpack the UmlDoc coming with the car-rental-sample so users can browse it -->
        <ant:unzip src="${maven.docs.dest}/resources/car-rental-umldoc.zip" dest="${maven.docs.dest}"/>
        <!-- zip it all up -->
        <ant:zip zipfile="${maven.build.dir}/docs.zip" prefix="docs">
            <ant:zipfileset dir="${maven.docs.dest}"/>
        </ant:zip>
    </goal>

    <!-- ===================================================================
          Iterate over each subproject and copy master CSS to 
          ${subproject.location}/xdocs/style
         =================================================================== -->
    <goal name="add-style">
        <ant:fileScanner var="projects">
            <ant:fileset dir="${maven.docs.dest}">
                <ant:patternset>         
                    <ant:include name="**/*maven-base.css"/>
                </ant:patternset>
            </ant:fileset>
        </ant:fileScanner>
        <j:forEach var="project" items="${projects.iterator()}">
            <ant:copy todir="${project.parent}" overwrite="true">
                <ant:fileset dir="${maven.docs.dest}/style"/>
            </ant:copy>
        </j:forEach>
    </goal>

    <!-- ==================================================================
            Cleans all documentation
         ================================================================== -->    
    <goal name="clean">
        <attainGoal name="multiproject:clean"/>
    </goal>

</project>
