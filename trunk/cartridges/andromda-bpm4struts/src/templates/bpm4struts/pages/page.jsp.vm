##
##
##      This macro takes care of rendering the appropriate Struts
##      HTML hyperlink tags for the argument action
##
##
#macro ( renderHyperlink $action $indent )
#set ($roles = $action.actionRoles)
#set ($trigger = $action.actionTrigger)
#set ($triggerKey = $trigger.triggerKey)
#set ($parameters = $action.actionParameters)
#set ($formBeanName = "form")
#set ($securityEnabled = ($security=="true") && ($roles != "") )
#if ($securityEnabled)
${indent}<logic:present role="$roles">
#end
#set ($requestPath = "${action.actionPath}")
#set ($separator = "?")
#foreach ($parameter in $parameters)
#set ($propertyName = "${formBeanName}.${parameter.name}")
#if($velocityCount > 1)#set($separator = "&")#end
#set ($requestPath = "${requestPath}${separator}${parameter.name}=${${propertyName}}")
#end
${indent}    <p>
${indent}        <html:link action="${requestPath}" #if($hints)onmouseover="hints.show('${trigger.name}')" onmouseout="hints.hide()"#end>
${indent}            <bean:message key="$triggerKey"/>
${indent}        </html:link>
${indent}    </p>
#if ($securityEnabled)
${indent}</logic:present>
${indent}<logic:notPresent role="$roles">
${indent}   <bean:message key="$triggerKey"/> <br/>
${indent}</logic:notPresent>
#end
#end
##
##
##      This macro takes care of rendering the appropriate Struts
##      HTML button tags for the argument action
##
##
#macro ( renderFormButtons $action $indent )
#set ($messageKey = $action.messageKey)
#set ($trigger = $action.actionTrigger)
#set ($roles = $action.actionRoles)
#set ($securityEnabled = ($security=="true") && ($roles != "") )
#if ($securityEnabled)
${indent}<logic:present role="$roles">
#end
${indent}   <html:submit #if($hints)onmouseover="hints.show('${trigger.name}')" onmouseout="hints.hide()"#end styleId="form_submit">
${indent}       <bean:message key="$trigger.triggerKey"/>
${indent}   </html:submit>
#if ($action.resettable)
${indent}   <html:reset #if($hints)onmouseover="hints.show('${trigger.name}_reset')" onmouseout="hints.hide()"#end styleId="form_reset">
${indent}       <bean:message key="$trigger.resetMessageKey"/>
${indent}   </html:reset>
#end
#if ($securityEnabled)
${indent}</logic:present>
${indent}<logic:notPresent role="$roles">
${indent}   <html:submit #if($hints)onmouseover="hints.show('${trigger.name}_no')" onmouseout="hints.hide()"#end disabled="true" styleId="form_submit">
${indent}       <bean:message key="$trigger.triggerKey"/>
${indent}   </html:submit>
#if ($action.resettable)
${indent}   <html:reset #if($hints)onmouseover="hints.show('${trigger.name}_noreset')" onmouseout="hints.hide()"#end disabled="true" styleId="form_reset">
${indent}       <bean:message key="$trigger.resetMessageKey"/>
${indent}   </html:reset>
#end
${indent}</logic:notPresent>
#end
#end
##
##
##      This macro takes care of rendering the appropriate Struts tags
##      for the argument form field
##
##
#macro ( renderFormField $action $field $indent)
#set ($fieldName = $field.name)
#set ($widgetType = $field.widgetType)
#set ($formBeanName = "form")
#if ($field.readOnly)
#set ($disabled = 'disabled="true"')
#set ($readonly = 'readonly="true"')
#else
#set ($disabled = '')
#set ($readonly = '')
#end
##
##  Depending on the type of the input field we render a different widget
##
##
##      R A D I O B U T T O N
##
#if ($widgetType == 'radio')
${indent}<table>
#foreach ($optionKey in $field.optionKeys)
${indent}    <tr>
${indent}        <td>
${indent}            <html:$widgetType name="$formBeanName" property="$fieldName" value="$optionKey" #if($hints)onmouseover="hints.show('$field.titleKey')" onmouseout="hints.hide()"#end $disabled/>
${indent}            <bean:message key="$optionKey"/>
${indent}        </td>
${indent}    </tr>
#end
${indent}</table>
##
##      C H E C K B O X
##
#elseif ($widgetType == 'checkbox')
${indent}<html:$widgetType name="$formBeanName" property="$fieldName" #if($hints)onmouseover="hints.show('$field.titleKey')" onmouseout="hints.hide()"#end $disabled/>
##
##      M U L T I B O X 
##
#elseif ($widgetType == 'multibox')
${indent}<html:$widgetType name="$formBeanName" property="$field.multiboxPropertyName" #if($hints)onmouseover="hints.show('$field.titleKey')" onmouseout="hints.hide()"#end $disabled>
#set ($multiboxBody = "${formBeanName}.${fieldName}")
${indent}    ${${multiboxBody}}
${indent}</html:$widgetType>
##
##      T E X T F I E L D       &       P A S S W O R D
##
#elseif ( ($widgetType == 'text') || ($widgetType == 'password') )
${indent}<html:$widgetType styleId="${formBeanName}_${fieldName}" name="$formBeanName" property="$fieldName" #if($hints)onmouseover="hints.show('$field.titleKey')" onmouseout="hints.hide()"#end $readonly/>
#if ( ($widgetType == 'text') && $field.calendarRequired )
${indent}<html:img page="/layout/calendar/calendar.gif" styleId="${formBeanName}_${fieldName}_trigger" styleClass="calendar" #if($hints)onmouseover="hints.show('calendar.popup')" onmouseout="hints.hide()"#end/>
${indent}<script type="text/javascript">
#if ($xhtml == "true")
${indent}//<![CDATA[
#else
${indent}//<!--
#end
${indent}    Calendar.setup({
${indent}        inputField     :    "${formBeanName}_${fieldName}",
${indent}        ifFormat       :    "$dateUtils.formatJavaToPerl($field.dateFormat)",
${indent}        daFormat       :    "%A, %B %d, %Y",
${indent}        showsTime      :    true,
${indent}        button         :    "${formBeanName}_${fieldName}_trigger",
${indent}        singleClick    :    true
${indent}    });
#if ($xhtml == "true")
${indent}//]]>
#else
${indent}//-->
#end
${indent}</script>
#end
##
##      T E X T A R E A
##
#elseif ($widgetType == 'textarea')
${indent}<html:$widgetType name="$formBeanName" property="$fieldName" #if($hints)onmouseover="hints.show('$field.titleKey')" onmouseout="hints.hide()"#end $readonly/>
##
##      H I D D E N
##
#elseif ($widgetType == 'hidden')
${indent}<html:$widgetType name="$formBeanName" property="$fieldName"/>
##
##      C O M B O B O X     &      L I S T
##
#elseif ($widgetType == 'select')
#if ($field.multiple)
#set ($multiple = 'multiple="multiple"')
#else
#set ($multiple = '')
#end
#if ($field.type.collectionType)
#set ($selectProperty = "${fieldName}AsArray")
#else
#set ($selectProperty = "$fieldName")
#end
${indent}<c:choose>
${indent}    <c:when test="${!empty ${formBeanName}.${field.backingListName}}">
${indent}       <html:select name="$formBeanName" property="$selectProperty" #if($hints)onmouseover="hints.show('$field.titleKey')" onmouseout="hints.hide()"#end $disabled $multiple>
${indent}           <html:optionsCollection name="$formBeanName" property="$field.backingListName" label="label" value="value"/>
${indent}       </html:select>
${indent}    </c:when>
${indent}    <c:otherwise>
${indent}        <html:select name="$formBeanName" property="$selectProperty" #if($hints)onmouseover="hints.show('$field.titleKey')" onmouseout="hints.hide()"#end disabled="true"/>
${indent}    </c:otherwise>
${indent}</c:choose>
##
##      L I N K     (will only work on tablelinks, this is ensured by the facade)
##
#elseif ($widgetType == 'link')
#foreach ($parameter in $field.action.actionParameters)
## Only add the parameter to the request if its been explicity set
## as a table link
#if ($parameter.tableLinkColumnName)
#set ($propertyName = "row.${parameter.tableLinkColumnName}")
#else
#set ($propertyName = "${formBeanName}.${parameter.name}")
#end
#if ($velocityCount == 1)
#set ($requestPath = "${field.action.actionPath}?${parameter.name}=${${propertyName}}")
#else
#set ($requestPath = "${requestPath}&${parameter.name}=${${propertyName}}")
#end
#end
${indent}<html:link action="${requestPath}">
#set ($linkName = "row.${field.tableLinkColumnName}")
${indent}    ${${linkName}}
${indent}</html:link>
##
##      F I L E
##
#elseif ($widgetType == 'file')
${indent}<html:$widgetType name="$formBeanName" property="$fieldName" #if($hints)onmouseover="hints.show('$field.titleKey')" onmouseout="hints.hide()"#end $disabled/>
##
##      P L A I N T E X T
##
#else
#if ($field.tableLinkColumnName != "")
#set ($plainText = "row.${field.tableLinkColumnName}")
#else
#set ($plainText = "${formBeanName}.${fieldName}")
#end
${indent}${${plainText}}
#end
#end
