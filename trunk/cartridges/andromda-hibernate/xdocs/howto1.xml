<?xml version="1.0" encoding="iso-8859-1"?>

<document>

    <properties>
        <author email="carloslcuenca@users.sourceforge.net">Carlos Cuenca</author>
        <title>AndroMDA - Hibernate - HowTo - Second Level Cache</title>
    </properties>

    <body>
        <section name="Hibernate Cartridge Second Level Cache">
            <subsection name="Hibernate Cartridge Second Level Cache">
                <p class="std">
                    Hibernate uses two different caches for objects. The first level cache, and the second level cache.
                </p>
                <p>
                    The first level cache is associated with the Session object, while the second level cache is
                    associated
                    with the hibernate SessionFactory object.
                </p>
                <p>
                    Currently, the cartridge architecture creates one Session object from the SessionFactory
                    object for each method that is called at the EJB's services.
                    This means that cache will be only used if a method is accessing the same object more than once.
                    This can be improved by activating the second level cache features provided by Hibernate.
                </p>
                <p>
                    To achieve this task, the cartridge includes support for generating the Hibernate descriptor files
                    will all the possible cache settings included in the hibernate specification.
                </p>
                <p>
                    Additionally, each second level cache manager usually needs its own descriptor file with
                    cache settings specific to this manager.
                    The cartridge provides a template for creating the EhCache Manager descriptor file.
                    For other managers, this template could be overwritten to generate another manager descriptor file.
                </p>
            </subsection>
            <subsection name="EHCache">
                <p>
                    Currently AndroMDA fully supports
                    <a href="http://ehcache.sourceforge.net">EhCache</a>to provide the second level cache features to
                    the cartridge. When enabled, the cartridge will create caches on queries, the Hibernate descriptor
                    files, and the <code>EhCache.xml</code>file with the specific configuration.
                </p>
            </subsection>
        </section>
        <section name="Working with Second Level Cache">
            <subsection name="Setup">
                <p>
                    The cache settings provides support for customize the cache configuration. The namespace properties
                    for the cache settings are the following:
                    <ul>
                        <li>
                            <a href="namespace.html#SecondLevelCache">hibernateCacheProvider</a>: Specifies the cache
                            provider implementation that will be used for caching services. Default value is
                            <code>net.sf.hibernate.cache.EhCacheProvider</code>
                        </li>
                        <li>
                            <a href="namespace.html#SecondLevelCache">hibernateQueryCacheFactory</a>: Factory class for
                            the cache queries. Default value is
                            <code>net.sf.hibernate.cache.StandardQueryCacheFactory</code>
                        </li>
                    </ul>
                </p>
                <p class="highlight">
                    Currently the cartridge only includes the dependencies for working with EhCache
                </p>
            </subsection>
            <subsection name="Activation">
                <p>
                    To enable cache features on generated files, the following namespace properties should be used.
                    <ul>
                        <li>
                            <a href="namespace.html#SecondLevelCache">hibernateEnableCache</a>: this property activates
                            the features for the cache on the cartridge. When enabled, the hibernate mapping files will
                            be created with the cache settings, and
                            the EhCache descriptor file will be created. Also the hibernate configuration file, will set
                            the <code>hibernate.cache.use_query_cache</code> to <code>true</code>.
                        </li>
                        <li>
                            <a href="namespace.html#SecondLevelCache">hibernateEnableAssociationsCache</a>: this
                            property activates the customized cache settings for each association. When enabled,
                            associations end could contain its own specific configuration.
                            Default values for not defined propertiesare allowed.
                        </li>
                    </ul>
                </p>
            </subsection>
            <subsection name="Entities">
                <p>
                    The cartridge provides a default namespace property for each entity cache settings configuration.
                    These properties will be applied by default (that is,
                    if there is no specific tagged value on the entity that overrides the value). Namespace properties
                    for entities are:
                    <ul>
                        <li>
                            <a href="namespace.html#SecondLevelCache">hibernateEntityCache</a>: The cartridge default
                            settings for this property is <code>read-write</code>, other possible values are
                            <code>nonstrict-read-write</code>and
                            <code>read-only</code>
                        </li>
                    </ul>
                    This property can be overridden using the following tagged value:
                    <ul>
                        <li>
                            <a href="modeling.html#@andromda.hibernate.entity.cache">@andromda.hibernate.entity.cache
                            </a>
                        </li>
                    </ul>
                </p>
                <h3>EhCache Configuration for Entities</h3>
                <p>
                    Namespace properties and tagged values are available to customize
                    <a href="http://ehcache.sourceforge.net/documentation/">EhCache Configuration</a>.
                    Namespace properties for EhCache configuration are:
                    <ul>
                        <li>
                            <a href="namespace.html#SecondLevelCache">ehCacheMaxElementsInMemory</a>: Defines the
                            default maximum number of objects that will be created in memory
                        </li>
                        <li>
                            <a href="namespace.html#SecondLevelCache">ehCacheEternal</a>: Defines a default value for
                            the eternal parameter.
                        </li>
                        <li>
                            <a href="namespace.html#SecondLevelCache">ehCacheTimeToIdleSeconds</a>: Defines the default
                            time to idle for an element before it expires.
                        </li>
                        <li>
                            <a href="namespace.html#SecondLevelCache">ehCacheTimeToLiveSeconds</a>: Defines the default
                            time to live for an element before it expires.
                        </li>
                        <li>
                            <a href="namespace.html#SecondLevelCache">ehCacheOverflowToDisk</a>: Defines the default
                            value for the overflow to disk property.
                        </li>
                    </ul>
                    The corresponding tagged values to overwrite the default values are:
                    <ul>
                        <li>
                            <a href="modeling.html#@andromda.hibernate.ehcache.maxElementsInMemory">
                                @andromda.hibernate.ehcache.maxElementsInMemory</a>
                        </li>
                        <li>
                            <a href="modeling.html#@andromda.hibernate.ehcache.eternal">
                                @andromda.hibernate.ehcache.eternal</a>
                        </li>
                        <li>
                            <a href="modeling.html#@andromda.hibernate.ehcache.timeToIdleSeconds">
                                @andromda.hibernate.ehcache.timeToIdleSeconds</a>
                        </li>
                        <li>
                            <a href="modeling.html#@andromda.hibernate.ehcache.timeToLiveSeconds">
                                @andromda.hibernate.ehcache.timeToLiveSeconds</a>
                        </li>
                        <li>
                            <a href="modeling.html#@andromda.hibernate.ehcache.overflowToDisk">
                                @andromda.hibernate.ehcache.overflowToDisk</a>
                        </li>
                    </ul>
                </p>
            </subsection>
            <subsection name="Associations">
                <p>
                    Associations caching configuration can be configured individually. The namespace default property
                    can be overridden using the tagged value.
                    Namespace property for EhCache configuration is:
                    <ul>
                        <li>
                            <a href="namespace.html#SecondLevelCache">hibernateAssociationCache</a>: The cartridge
                            default settings for this property is <code>read-write</code>, other possible values are
                            <code>nonstrict-read-write</code>and
                            <code>read-only</code>
                        </li>
                    </ul>
                    Tagged value:
                    <ul>
                        <li>
                            <a href="modeling.html#@andromda.hibernate.association.cache">
                                @andromda.hibernate.association.cache</a>
                        </li>
                    </ul>
                </p>
            </subsection>
            <subsection name="Finder Methods">
                <p>
                    The cartridge provides default namespace properties for activating the cache on one query.
                    When enabled the generated code will contain an additional
                    <code>query.setCacheable(true)</code>line.
                    The namespace property for finder methods is:
                    <ul>
                        <li>
                            <a href="namespace.html#SecondLevelCache">hibernateUseQueryCache</a>: The cartridge default
                            settings for this property is <code>read-write</code>, other possible values are
                            <code>nonstrict-read-write</code>and
                            <code>read-only</code>
                        </li>
                    </ul>
                    This default value will be used for all the queries that are not overridden using the tagged value:
                    <ul>
                        <li>
                            <a href="modeling.html#@andromda.hibernate.query.useCache">
                                @andromda.hibernate.query.useCache</a>
                        </li>
                    </ul>
                </p>
            </subsection>
        </section>
    </body>
</document>
