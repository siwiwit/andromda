<project default="jar:install"
         xmlns:ant="jelly:ant"
         xmlns:maven="jelly:maven"
         xmlns:j="jelly:core">

    <!--
        1. unzip all howto files so users can browse their content online
        2. run andromda on the howto model
    -->
    <preGoal name="xdoc:transform">
        <!-- add spring classes to the classpath -->
        <ant:path id="spring.classes" location="${maven.build.dest}"/>
        <maven:addPath id="maven.dependency.classpath" refid="spring.classes"/>
        <!-- set properties to call andromda:run with -->
        <j:set var="maven.andromda.model.uri" value="${howto.model.uri}"/>
        <j:set var="maven.andromda.modelValidation" value="${howto.modelValidation}" defaultValue="true"/>
        <j:set var="maven.andromda.cartridgeFilter" value="${howto.cartridgeFilter}"/>
        <j:set var="maven.andromda.modelPackage.0.name" value="${howto.modelPackage.0.name}"/>
        <j:set var="maven.andromda.modelPackage.0.shouldProcess" value="${howto.modelPackage.0.shouldProcess}"/>
        <attainGoal name="andromda:run"/>
        <ant:unzip src="${howto.pictures.zip}" dest="${howto.output.dir}"/>
    </preGoal>

    <preGoal name="generate-source">
        <j:set var="maven.andromda.model.uri" value="${metafacade.model.uri}"/>
        <j:set var="maven.andromda.modelValidation" value="${metafacade.modelValidation}" defaultValue="true"/>
        <j:set var="maven.andromda.cartridgeFilter" value="${metafacade.cartridgeFilter}"/>
        <j:set var="maven.andromda.modelPackage.0.name" value="${metafacade.modelPackage.0.name}"/>
        <j:set var="maven.andromda.modelPackage.0.shouldProcess" value="${metafacade.modelPackage.0.shouldProcess}"/>
    </preGoal>

</project>

