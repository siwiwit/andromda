<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>TimeTrackingService Definition</title>
</head>
<body>
    <h2>TimeTrackingService Definition</h2>
    <!------------------------- Intro Text ------------------------->
    <p>
        We are now on iteration 2. The goal of this iteration is to build the Search Results
        panel. To refresh our memories, here's the mockup of the Search screen. The Search
        Results panel is the panel on the right that shows a table of timecards.
    </p>
    <!------------------------- Main Text ------------------------->
    <table width="100%" border="0">
        <tbody>
            <tr>
                <!-- img src="Images/SearchScreen_new.jpg" alt="Search Screen" / -->
                <td align="center" style="width: 100%">
                    {mosimage}</td>
            </tr>
        </tbody>
    </table>
    <h3>Value Objects</h3>
    <p>
        To support the Search Results panel, the service layer must provide the ability
        to get a list of timecards that match a specific criteria. Let's decide that we
        will create a service called <code>TimeTrackingService</code> that will provide
        this functionality via the method specified below:
    </p>
    <pre>
public interface TimeTrackingService
{
    public TimecardSummaryVO[] findTimecards(TimecardSearchCriteriaVO criteria);
}
    </pre>
    <p>
        Here <code>TimecardSearchCriteriaVO</code> is a value object that packages timecard
        search criteria - if a field in this class is specified, then that criterion applies;
        if the field is left as null, then that criterion does not apply. <code>TimecardSummaryVO</code>
        is another value object that packages summary information about each timecard. Based
        on the fields in the Search screen, let's design these two value objects. Note that
        we need a status field in both these value objects. So first create an enumeration
        called <code>TimecardStatus</code> under the <code>org.andromda.timetracker.domain</code>
        package as shown below. To do this, create a class in the "Domain Objects" diagram,
        and give it the stereotype of <code>Enumeration</code>. Then add the four enumeration
        values as shown below - these are added as attributes. Make sure the enumeration
        is created in the <code>org.andromda.timetracker.domain</code> package by inspecting
        the containment tree.
    </p>
    <p>
        {mosimage}
        <!-- img src="Images/TimecardStatus.jpg" alt="TimecardStatus" / -->
    </p>
    <p>
        Now that <code>TimecardStatus</code> is defined, we can define the two value objects
        needed by the <code>findTimecards()</code> service method. Create <code>TimecardSearchCriteriaVO</code>
        and <code>TimecardSummaryVO</code> under the <code>org.andromda.timetracker.vo</code>
        package as shown below. Create these value objects in the "Value Objects" diagram.
        Note that the multiplicity of each attribute in <code>TimecardSearchCriteriaVO</code>
        is set to 0..1 - indicating that their value could be left as null. To specify the
        multiplicity of an attribute, you must double-click on the attribute to open its
        specification and then choose the right multiplicity. In addition to the two value
        objects, create a class called <code>TimecardSummaryVO[]</code> to represent an
        array of timecard summaries. Make sure these three classes are created in the <code>
            org.andromda.timetracker.vo</code> package by inspecting the containment tree.
    </p>
    <p>
        {mosimage}
        <!-- img src="Images/SearchResultsPanelValueObjects.jpg" alt="Search Results Panel value objects" / -->
    </p>
    <h3>TimeTrackingService</h3>
    <p>
        We now have everything to define our <code>TimeTrackingService</code>. Create this
        service under the <code>org.andromda.timetracker.service</code> package as shown
        below. Create it in the "Services" diagram and make sure the service is created
        in the <code>org.andromda.timetracker.service</code> package by inspecting the containment
        tree. Also make sure that the return type of <code>findTimecards</code> is <code>TimecardSummaryVO[]</code>
        by verifying it in the operation specification.
    </p>
    <p>
        {mosimage}
        <!-- img src="Images/TimeTrackingService.jpg" alt="TimeTrackingService" / -->
    </p>
    <p>
        Now let's ask AndroMDA to generate code:
    </p>
    <ol>
        <li>Execute the command <code>mvn install</code> in the Command Prompt. Make sure you
            get a <code>BUILD SUCCESSFUL</code> message.</li>
    </ol>
    <p>
        Verify that the following files are generated in the appropriate directories:
    </p>
    <ol>
        <li>common\target\src\org\andromda\timetracker\domain\TimecardStatus.java</li>
        <li>common\target\src\org\andromda\timetracker\vo\TimecardSummaryVO.java</li>
        <li>common\target\src\org\andromda\timetracker\vo\TimecardSearchCriteriaVO.java</li>
        <li>common\target\src\org\andromda\timetracker\service\TimeTrackingService.java</li>
        <li>core\target\src\org\andromda\timetracker\service\TimeTrackingServiceBase.java</li>
        <li>core\src\main\java\org\andromda\timetracker\service\TimeTrackingServiceImpl.java</li>
    </ol>
    <h3>TimeTrackingService Test</h3>
    <p>
        As with <code>UserService</code>, we will first write a test for <code>TimeTrackingService</code>
        and then write the implementation to make the test pass. Follow the steps below
        to create <code>TimeTrackingServiceTest</code> and run it:
    </p>
    <ol>
        <li>Copy <code>TimeTrackingServiceTest.java</code> from the directory <code>C:\timetracker-completed\core\src\test\java\org\andromda\timetracker\service</code>
            to the corresponding directory under your implementation. This file contains two
            tests for <code>findTimecards()</code>: <code>testFindAllTimecards()</code> and
            <code>testFindTimecardsForSubmitter</code>. Review both tests and make sure you
            understand them.</li>
        <li>Edit your copy of <code>testng.xml</code> under <code>C:\timetracker\core\src\test\resources</code>
            and uncomment <code>TimeTrackingServiceTest</code> so that it is enabled for execution.</li>
        <li>Execute the following command in the <code>C:\timetracker</code> directory to run
            the test.<br />
            <code>mvn -f core/pom.xml test</code><br />
            You will find that the test fails with the following message:
            <pre>
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running Services Test
Tests run: 3, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 0.661 sec <<< FAILURE!

Results :
Tests run: 3, Failures: 2, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[ERROR] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] There are test failures.
[INFO] ------------------------------------------------------------------------
[INFO] For more information, run Maven with the -e switch
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 19 seconds
[INFO] Finished at: Sun Aug 06 18:38:26 EDT 2006
[INFO] Final Memory: 5M/11M
[INFO] ------------------------------------------------------------------------
            </pre>
        </li>
        <li>Let's look at the test results to see what happened. Open <code>C:\timetracker\core\target\surefire-reports\Services
            Test.txt</code>. You will see the following log:
            <pre>
-------------------------------------------------------------------------------
Test set: Services Test
-------------------------------------------------------------------------------
Tests run: 3, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 0.661 sec <<< FAILURE!
testFindAllTimecards  Time elapsed: 0.31 sec  <<< FAILURE!
java.lang.NullPointerException
	at ...(TimeTrackingServiceTest.java:58)
	at ...(TimeTrackingServiceTest.java:41)

testFindTimecardsForSubmitter  Time elapsed: 0.01 sec  <<< FAILURE!
java.lang.NullPointerException
	at ...(TimeTrackingServiceTest.java:58)
	at ...(TimeTrackingServiceTest.java:50)
            </pre>
            Obviously the service is currently returning null instead of <code>TimecardSummaryVO[]</code>.
            This problem will be fixed when we implement the service. </li>
    </ol>
    <h3>What's Next?</h3>
    <p>
        The next step is to implement the <code>findTimecards()</code> method. Click the
        <em>Next</em> link below to start this implementation.
    </p>
</body>
</html>
