<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Details Column</title>
</head>
<body>
    <h2>Details Column</h2>
    <!------------------------- Intro Text ------------------------->
    <p>
        In this section we will add the details column to the results table. This column
        will have buttons that will take you to the Timecard Details page when clicked.
        The modified activity diagram for this functionality is shown below:
    </p>
    <!------------------------- Main Text ------------------------->
    <table width="100%" border="0">
        <tbody>
            <tr>
                <!-- img src="Images/SearchTimecardsAD3.jpg" alt="Search Timecards Activity Diagram" / -->
                <td align="center" style="width: 100%">
                    {mosimage}</td>
            </tr>
        </tbody>
    </table>
    <p>
        This activity diagram has no new modeling concepts, so we will give you just the
        high level steps to construct it. In general, we are trying to create a <code>details</code>
        trigger coming out of the <code>Search Timecards</code> view. The <code>details</code>
        trigger will contain an <code>id</code> parameter that indicates which timecard
        was clicked. We need to pass this <code>id</code> to the next use case called <code>
            Timecard Details</code>. However, since <code>id</code> is not a very descriptive
        name we would like to convert it to a page variable called <code>timecardId</code>,
        which will be passed to the next page. The activity called <code>Initialize Timecard
            Id</code> transforms the <code>id</code> parameter to the <code>timecardId</code>
        page variable. So, without further delay, here are the steps to update your activity
        diagram:
    </p>
    <ol>
        <li>First create the action state called <code>Initialize Timecard Id</code>. Remember
            that the <em>Name</em> of the action state should be <code>Initialize Timecard Id</code>
            (not just its label). This is done by double-clicking the state and entering the
            name in the action state specification.</li>
        <li>Create a transition from <code>Search Timecards</code> to <code>Initialize Timecard
            Id</code>. Create a signal trigger on this transition called <code>details</code>
            and add a parameter to it called <code>id</code> of type <code>Long</code>. (This
            is similar to adding the <code>search</code> trigger out of <code>Search Timecards</code>.)</li>
        <li>Add a tag to the <code>id</code> parameter called <code>@andromda.presentation.web.view.field.type</code>
            and set its value to <code>link</code>. This tag ensures that the <code>id</code>
            column in the table will be a link instead of the default text box.</li>
        <li>Add a tag on the transition (not on the trigger) called <code>@andromda.presentation.web.action.tablelink</code>
            and set its value to <code>timecardSummaries</code>. This tag ensures that the <code>
                details</code> trigger will occur on the table that displays <code>timecardSummaries</code>.
            Also since we are not specifying any attribute in this value (such as <code>timecardSummaries.id</code>)
            a separate column will be created with buttons named <code>Details</code>.</li>
        <li>Create a final state.</li>
        <li>Add a transition from <code>Initialize Timecard Id</code> to the final state.</li>
        <li>Create a page variable called <code>timecardId</code> of type <code>Long</code>
            on this transition. Remember that page variables are created by first creating a
            signal trigger with no name and adding the page variable as a parameter on this
            trigger. (This is similar to adding the <code>timecardSummaries</code> page variable.)</li>
        <li>Switch to the <code>Services</code> diagram for a second and add the following method
            to the <code>SearchController</code><br />
            <code>+initializeTimecardId(id : Long, timecardId : Long) : void</code></li>
        <li>Switch back to the activity diagram and call the <code>initializeTimecardId()</code>
            method from the <code>Initialize Timecard Id</code> action state. Remember that
            the call should be added as a deferrable event. (This is similar to adding the <code>
                populateSearchScreen()</code> call to the <code>Populate Search Screen</code>
            action state.) <em>MagicDraw users: You can create and call the <code>SearchController.initializeTimecardId()</code>
                method, all in one step, when editing the call trigger. This is done using the "New
                Button" on the right of the combobox. It's a shortcut that frees you from switching
                to another diagram.</em></li>
        <li>We need to connect the final state to the next use case which is <code>Timecard
            Details</code>. To do this, simply open the specification for the final state by
            double-clicking on it. In the <em>Name</em> field, enter <code>Timecard Details</code>.
            AndroMDA does a name match to connect the final state to the target use case (which
            we have not created yet).</li>
    </ol>
    <p>
        That completes the <code>Search Timecards</code> activity diagram. Of course, we
        still need to create the <code>Timecard Details</code> use case, otherwise AndroMDA
        will complain that it cannot find the target for the final state in the <code>Search
            Timecards</code> activity diagram. Follow the steps below to create a very simple
        <code>Timecard Details</code> use case:
    </p>
    <ol>
        <li>Open the use case diagram called <code>Application Use Cases</code>.</li>
        <li>Add a new use case and call it <code>Timecard Details</code>. Give it the <code>
            FrontEndUseCase</code> stereotype.</li>
        <li>In the model, create a new package under <code>org.andromda.timetracker.web</code>
            and call it <code>timecarddetails</code>.</li>
        <li>Move the <code>Timecard Details</code> use case from the <code>Use Cases</code>
            package to the <code>timecarddetails</code> package that we just created. This can
            be done in the Containment Tree.</li>
        <li>Now create a class called <code>TimecardController</code> under the <code>timecarddetails</code>
            package.</li>
        <li>Create a new activity diagram under the <code>Timecard Details</code> use case and
            name it <code>Timecard Details Activity Diagram</code>.</li>
        <li>Connect the <code>TimecardController</code> to the activity diagram using the procedure
            specific to your modeling tool. (This is similar to the way we connected the <code>SearchController</code>
            to the <code>Search Timecards</code> activity diagram.)</li>
        <li>Open the <code>Timecard Details</code> activity diagram and enter the following
            elements to it. Note that the page variable <code>timecardId</code> gets its value
            from the previous use case (<code>Search Timecards</code>).</li>
    </ol>
    <table width="100%" border="0">
        <tbody>
            <tr>
                <!-- img src="Images/TimecardDetailsAD1.jpg" alt="Timecard Details Activity Diagram" / -->
                <td align="center" style="width: 100%">
                    {mosimage}</td>
            </tr>
        </tbody>
    </table>
    <p>
        Now let's ask AndroMDA to generate code for the modified model:
    </p>
    <ol>
        <li>Execute the commands <code>mvn clean</code> followed by <code>mvn install</code>
            in the Command Prompt. The build will fail complaining about the <code>SearchControllerImpl</code>
            class because we have not implemented the <code>initializeTimecardId()</code> method.</li>
        <li>Open <code>SearchControllerImpl.java</code> and add the following code to it.
            <pre>
    public final void initializeTimecardId(
        ActionMapping mapping,
        org.andromda.timetracker.web.timecardsearch.InitializeTimecardIdForm form,
        HttpServletRequest request,
        HttpServletResponse response)
    throws Exception
    {
        form.setTimecardId(form.getId());
    }
            </pre>
        </li>
        <li>Build only the web project to make sure the code added above is compiled and packaged.
            Here's how:<br />
            <code>mvn -f web/pom.xml install</code></li>
        <li>Make sure the JBoss server is running.</li>
        <li>Deploy the application:<br />
            <code>mvn -f app/pom.xml -Ddeploy</code></li>
        <li>Open a browser and make it point to http://localhost:8080/timetracker. The TimeTracker
            search page should appear with <code>Details</code> buttons in the results panel.
            <em>Note: You may have to click your browser's refresh button to clear its cache and
                grab a fresh copy of the page.</em></li>
        <li>Click on one of the <code>Details</code> buttons. The browser should forward to
            the <code>Timecard Details</code> page. Notice that <code>id</code> is passed as
            a parameter in the URL.</li>
    </ol>
    <p>
        Below is a screen shot of the Search screen so far.
    </p>
    <table width="100%" border="0">
        <tbody>
            <tr>
                <!-- img src="Images/SearchResultsPanel2.jpg" alt="Search Results Panel" / -->
                <td align="center" style="width: 100%">
                    {mosimage}</td>
            </tr>
        </tbody>
    </table>
    <h3>What's Next?</h3>
    <p>
        We have now implemented the full functionality of the search screen. All that remains
        is the look and feel as specified by the TimeTracker prototype. Click the <em>Next</em>
        link below to start customizing the look and feel.
    </p>
</body>
</html>
