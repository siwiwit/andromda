<project default="install"
	     xmlns:j="jelly:core"
  		 xmlns:ant="jelly:ant"
  		 xmlns:maven="jelly:maven">
  		 
  	<!-- ==================================================================
  			 Installs all libraries in the local repository                                                    
  		 ================================================================== -->
  	<goal name="install">
		<attainGoal name="multiproject:install"/>	
  	</goal> 
  		 
  	<j:set var="andromda.metafacade.generated.dir" value="${maven.build.src}/andromda/meta"/>
  	<j:set var="andromda.metafacade.manual.dir" value="${maven.src.dir}/facades/manual"/>
  		 
    <preGoal name="java:compile"> 
   		<ant:available 
   			file="${maven.src.dir}/uml"
      		type="dir" 
      		property="hasModel"/>
		
		<j:set var="skipProcessing" value="${skip.andromda.plugin.processing}"/>
		<j:if test="${!empty(hasModel) and empty(skipProcessing)}">
		    <attainGoal name="andromda:run"/>
	  		<!-- add the paths of the generated source to the
	  		     maven compile path -->
	 	 	<ant:path
		       	id="metafacade.generated.src"
		       	location="${andromda.metafacade.generated.dir}"/>
			<maven:addPath
		       	id="maven.compile.src.set"
		       	refid="metafacade.generated.src"/>     		     
		 	<ant:path
		       	id="metafacade.manual.src"
		       	location="${andromda.metafacade.manual.dir}"/>
			<maven:addPath
		       	id="maven.compile.src.set"
		       	refid="metafacade.manual.src"/>      	
		</j:if>
    </preGoal>
  		 
</project>


