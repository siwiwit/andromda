#parse("templates/StrutsJSP.vm")
#set ($generatedFile = "${jsp.fullPath}.jsp")
##
##  CONSTANTS
##
#set ($actions = $jsp.actions)
#set ($pageVariables = $jsp.pageVariables)
#set ($hints = $hints == "true")
##
##  START TEMPLATE
##
#set ($hasTable = false)
<%@ include file="/taglib-imports.jspf" %>
#if (!$pageVariables.empty)
<%@ include file="${jsp.fullPath}-vars.jspf" %>
#foreach ($variable in $pageVariables)
#if ($variable.table)
#set ($hasTable = true)
#end
#end
#end

#if ($maxBreadCrumbs != "0")
<breadcrumbs:resize size="$maxBreadCrumbs"/>
<breadcrumbs:add value="$jsp.titleKey"/>
#end

#if ($xhtml == "true")
<html:xhtml/>

#end
<tiles:insert definition="main.layout">

##
##  SETS THE TITLE
##
    <tiles:put name="title" type="string">
        <bean:message key="$jsp.titleKey"/>
    </tiles:put>

##
##  SET PAGE STYLES
##
    <tiles:put name="style" type="string">
        <link rel="stylesheet" type="text/css" media="screen" href="<html:rewrite page="${jsp.fullPath}.css"/>"></link>
    </tiles:put>

##
##  SETS THE JAVASCRIPT CONTENT
##
    <tiles:put name="javascript" type="string">
## only load the calendar javascript when actually needed
#if ($jsp.calendarRequired)
    	<script type="text/javascript" language="Javascript1.1" src="<html:rewrite page="/layout/calendar-js.jsp"/>"></script>
#end
## only load the static javascript when it will actually be used
#set ($validationDesired = ($clientValidation=='true'))
#if ($jsp.validationRequired && $validationDesired)
        <script type="text/javascript" language="Javascript1.1" src="<html:rewrite page="/form-validation.jsp"/>"></script>
#foreach ($action in $actions)
#if ($action.validationRequired)
#if ($xhtml == "true")
        <html:javascript formName="$action.formBeanName" method="$action.formValidationMethodName" dynamicJavascript="true" staticJavascript="false" cdata="true"/>
#else
        <html:javascript formName="$action.formBeanName" method="$action.formValidationMethodName" dynamicJavascript="true" staticJavascript="false" htmlComment="true" cdata="false"/>
#end
#end
#end
#end
#if ($hints)
    	<script type="text/javascript" language="Javascript1.1" src="<html:rewrite page="/layout/hints.js"/>"></script>
    	<script type="text/javascript" language="Javascript1.1">
#if ($xhtml == "true")
        //<![CDATA[
#else
        //<!--
#end
            var HINTS_ITEMS = {
#foreach ($parameter in $jsp.allActionParameters)
                '$parameter.titleKey':'<formatting:escape language="javascript"><bean:message key="$parameter.titleKey"/></formatting:escape>',
#end
#foreach ($action in $jsp.actions)
#set ($trigger = $action.actionTrigger)
                '${trigger.name}':'<formatting:escape language="javascript"><bean:message key="$trigger.titleKey"/></formatting:escape>',
                '${trigger.name}_no':'<formatting:escape language="javascript"><bean:message key="$trigger.notAllowedTitleKey"/></formatting:escape>',
                '${trigger.name}_reset':'<formatting:escape language="javascript"><bean:message key="$trigger.resetTitleKey"/></formatting:escape>',
                '${trigger.name}_noreset':'<formatting:escape language="javascript"><bean:message key="$trigger.resetNotAllowedTitleKey"/></formatting:escape>',
#end
                'calendar.popup':'<formatting:escape language="javascript"><bean:message key="calendar.popup"/></formatting:escape>'
            };

            var hints = new THints (HINTS_CFG, HINTS_ITEMS);
#if ($xhtml == "true")
        //]]>
#else
        //-->
#end
    	</script>
#end
    </tiles:put>

##
##  SETS THE BODY OF THIS PAGE
##
    <tiles:put name="body" type="string">
   
        <%--
            If you want your own custom messages to be displayed
            you do just need to edit the custom.properties resource bundle.

            These properties can be used like this:

                <bean:message key="propertyKey" bundle="$customResourcesKey"/>
        --%>

        <div>
#if ($maxBreadCrumbs != "0")
            <tiles:insert definition="breadcrumbs.tile" flush="false">
                <tiles:put name="current.page.title" type="string" value="$jsp.titleKey"/>
            </tiles:insert>
#end
            <h1><bean:message key="$jsp.titleKey"/></h1>
        </div>

#foreach ($variable in $pageVariables)
#if (!$variable.table)
        <c:choose>
            <c:when test="${!empty ${variable.name}}">
                ${${variable.name}}
            </c:when>
            <c:otherwise>
                Missing from request : ${variable.name} <br/>
            </c:otherwise>
        </c:choose>
#end
#end

#foreach ($action in $actions)
#if ($action.tableLinkPresent == false)
        <tiles:insert page="${action.fullTilePath}.jsp" flush="false"/>

#end
#end
#foreach ($variable in $pageVariables)
#set ($targetColumns = $variable.targettedTableColumnNames)
#if ($variable.table)
#set ($sortable = $variable.tableSortable)
#set ($exportable = $variable.tableExportable)
        <div id="${variable.name}" class="table">
#if ($variable.tableAction)
            <html:form action="$variable.tableAction.actionPath">
#end
                <display:table name="${${variable.name}}" id="row"
                           requestURI="${pageContext.request.requestURI}"
                           export="$exportable" pagesize="$variable.tableMaxRows" sort="list">
#if (!$variable.tableColumnNames.empty)
#foreach ($columnName in $variable.tableColumnNames)
#if ($targetColumns.contains($columnName))
#set ($link = false)
#foreach ($tableLink in $variable.tableLinks)
#if ($tableLink.tableLinkColumnName == $columnName)
#set ($link = $tableLink)
#end
#end
                    <display:column media="xml excel csv"
                        property="$columnName" title="$str.toPhrase($columnName)"
                        sortable="$sortable" autolink="true" nulls="false"
                        paramId="$columnName" />
                    <display:column media="html"
                        headerClass="${columnName}"
                        title="$str.toPhrase($columnName)"
                        sortable="$sortable" autolink="false" nulls="false"
                        paramId="$columnName" >
                        <div class="$columnName">
#renderFormField($variable.tableAction $link "                            ")
                        </div>
                    </display:column>
#else
                    <display:column
                        headerClass="${columnName}"
                        title="$str.toPhrase($columnName)"
                        sortable="$sortable" autolink="true" nulls="false"
                        paramId="$columnName" >
                        <div class="${columnName}">
                            <bean:write name="row" property="$columnName" scope="page"/>
                        </div>
                    </display:column>
#end
#end
#end
                </display:table>
#if ($variable.tableAction)
## temporarily commented out
##renderFormButtons($variable.tableAction "            ")
            </html:form>
#end
        </div>

#end
#end
        <div>
            <blockquote>
#if ($jsp.validationRequired && ($clientValidation=='true' || $serverValidation=='true'))
                <bean:message key="required.fields.asterisk"/>
#end
#if ($onlineHelp == "true")
                <a href="" id="pageHelp" style="display:inline;" onclick="openWindow('<html:rewrite page="${jsp.fullPath}_help.jsp"/>','onlinehelp',true,false,760,540); return false;">
                    <bean:message key="online.help.href"/>
                </a>
                <html:img page="/layout/help.gif" style="display:inline;"/>
#end
            </blockquote>
        </div>

    </tiles:put>

</tiles:insert>
