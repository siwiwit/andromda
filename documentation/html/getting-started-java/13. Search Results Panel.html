<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Search Results Panel</title>
</head>
<body>
    <h2>Search Results Panel</h2>
    <!------------------------- Intro Text ------------------------->
    <p>
        We are now ready to implement the Search Results panel. We will do this by enhancing
        the Search Timecards activity diagram in two stages. The first stage will introduce
        the results table and the second stage will introduce the navigation to the Timecard
        Details page. The modified activity diagram for stage one is shown below:
    </p>
    <!------------------------- Main Text ------------------------->
    <table width="100%" border="0">
        <tbody>
            <tr>
                <!-- img src="Images/SearchTimecardsAD2.jpg" alt="Search Timecards Activity Diagram" / -->
                <td align="center" style="width: 100%">
                    {mosimage}</td>
            </tr>
        </tbody>
    </table>
    <p>
        Notice that we have added a <em>page variable</em> called <code>timecardSummaries</code>,
        which is an array of <code>TimecardSummaryVO</code> objects. This page variable
        will be tagged to tell AndroMDA to render it as a table. Follow one of the links
        below to add the page variable to your model.
    </p>
    <ul>
        <li><a href="/index.php?option=com_content&amp;task=view&amp;id=194&amp;Itemid=42"
            target="_blank">ArgoUML</a></li>
        <li><a href="/index.php?option=com_content&amp;task=view&amp;id=169&amp;Itemid=42"
            target="_blank">MagicDraw 9.x</a></li>
        <li><a href="/index.php?option=com_content&amp;task=view&amp;id=172&amp;Itemid=42"
            target="_blank">MagicDraw 15.5</a></li>
        <li><a href="/index.php?option=com_content&amp;task=view&amp;id=176&amp;Itemid=42"
            target="_blank">RSM 6</a></li>
    </ul>
    <p>
        We now need to enhance our <code>SearchController</code> to fill in this page variable
        with search results. For this to happen, we need to do two things:
    </p>
    <ol>
        <li>The page variable must be made available to the <code>populateSearchScreen()</code>
            method. To do this, add a sixth parameter to this method in the model. The name
            and type of the parameter must match the <code>timecardSummaries</code> page variable
            exactly.</li>
        <li><code>SearchController</code> needs access to the <code>TimeTrackingService</code>.
            Open the <code>Services</code> diagram and add a dependency from <code>SearchController</code>
            to <code>TimeTrackingService</code> as shown below. Note that we have suppressed
            the full signature of the <code>findTimeCards()</code> method. </li>
    </ol>
    <table width="100%" border="0">
        <tbody>
            <tr>
                <!-- img src="Images/SearchControllerToTimeTrackingService.jpg" alt="Search Controller" / -->
                <td align="center" style="width: 100%">
                    {mosimage}</td>
            </tr>
        </tbody>
    </table>
    <p>
        Now let's ask AndroMDA to generate code for the modified <code>Search Timecards</code>
        functionality:
    </p>
    <ol>
        <li>Execute the command <code>mvn install</code> in the Command Prompt. Make sure you
            get a <code>BUILD SUCCESSFUL</code> message.</li>
    </ol>
    <p>
        Next we need to modify the <code>SearchController</code> to initialize the <code>timecardSummaries</code>
        page variable with search results. To do this, open the file <code>SearchControllerImpl.java</code>
        and add the code shown below in bold:
    </p>
    <pre>
// license-header java merge-point
package org.andromda.timetracker.web.timecardsearch;

...
import javax.servlet.http.HttpServletResponse;
<b>import org.andromda.timetracker.domain.TimecardStatus;</b>
<b>import org.andromda.timetracker.vo.TimecardSearchCriteriaVO;</b>
<b>import org.andromda.timetracker.vo.TimecardSummaryVO;</b>
import org.andromda.timetracker.vo.UserVO;
...

public class SearchControllerImpl extends SearchController
{
    ...
    public final void populateSearchScreen(...)
    throws Exception
    {
        ...

        // Populate submitter and approver dropdowns
        form.setSubmitterBackingList(userList, "id", "username");
        form.setApproverBackingList(userList, "id", "username");

        <b>// Populate status dropdown</b>
        <b>List statusLabels = new ArrayList(TimecardStatus.literals());</b>
        <b>List statusValues = new ArrayList(TimecardStatus.literals());</b>
        <b>statusLabels.add(0, ALL_STRING);</b>
        <b>statusValues.add(0, "");</b>
        <b>form.setStatusLabelList(statusLabels.toArray());</b>
        <b>form.setStatusValueList(statusValues.toArray());</b>

        <b>// Populate timecard summaries</b>
        <b>TimecardStatus status = null;</b>
        <b>if (form.getStatus() != null && form.getStatus().length() > 0) {</b>
            <b>status = TimecardStatus.fromString(form.getStatus());</b>
        <b>}</b>
        <b>TimecardSearchCriteriaVO criteria = new TimecardSearchCriteriaVO(</b>
            <b>form.getSubmitter(),</b>
            <b>form.getApprover(),</b>
            <b>status,</b>
            <b>form.getStartDateMinimumAsDate(),</b>
            <b>form.getStartDateMaximumAsDate());</b>

        <b>TimecardSummaryVO[] timecards =</b>
            <b>getTimeTrackingService().findTimecards(criteria);</b>
        <b>form.setTimecardSummaries(timecards);</b>
    }
}
    </pre>
    <p>
        Follow the steps below to build and deploy the application to JBoss and test it.
    </p>
    <ol>
        <li>Build only the web project to make sure the code added above is compiled and packaged.
            Here's how:<br />
            <code>mvn -f web/pom.xml install</code></li>
        <li>Make sure the JBoss server is running.</li>
        <li>Deploy the application:<br />
            <code>mvn -f app/pom.xml -Ddeploy</code></li>
        <li>Open a browser and make it point to http://localhost:8080/timetracker. The TimeTracker
            search page should appear along with search results. You should be able to change
            the search parameters to see new search results.</li>
    </ol>
    <p>
        Below is a screen shot of the Search screen so far.
    </p>
    <table width="100%" border="0">
        <tbody>
            <tr>
                <!-- img src="Images/SearchResultsPanel1.jpg" alt="Search Results Panel" / -->
                <td align="center" style="width: 100%">
                    {mosimage}</td>
            </tr>
        </tbody>
    </table>
    <h3>What's Next?</h3>
    <p>
        Now that the search results table is showing well, we need to add the details column
        that will allow us to navigate to the Timecard Details page. Click the <em>Next</em>
        link below to add this column.
    </p>
</body>
</html>
