<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Create Search Timecards Use Case</title>
</head>
<body>
    <h2>Create Search Timecards Use Case</h2>
    <!------------------------- Intro Text ------------------------->
    <p>
        This page provides directions to create the <code>Search Timecards</code> use case
        along with its activity diagram and the <code>SearchController</code>. Use the containment
        tree shown below to guide you throughout this procedure. Note that all three elements
        mentioned here will be placed in the package <code>org.andromda.timetracker.web.timecardsearch</code>.
    </p>
    <!------------------------- Main Text ------------------------->
    <table width="100%" border="0">
        <tbody>
            <tr>
                <!-- img src="images/SearchTimecardsExplorerPane.png" alt="Search Timecards Tree" / -->
                <td align="center" style="width: 100%">
                    {mosimage}</td>
            </tr>
        </tbody>
    </table>
    <p>
        Let's start by creating the <code>Search Timecards</code> use case.
    </p>
    <p>
        {mosimage}
        <!-- img src="images/SearchTimecardsUC.png" alt="Search Timecards Use Case" / -->
    </p>
    <ol>
        <li>Create a package under the <code>TimeTracker</code> model by right-clicking on it
            in the containment tree and selecting <code>Add Package</code>. Name this new package
            <code>Use Cases</code> because we will create our use case diagrams here. </li>
        <li>In the <code>Use Cases</code> package, create a use case diagram by right clicking
            on it and selecting Create Diagram&rarr;New Use Case Diagram. On the property panel,
            enter the name <code>Application Use Cases</code> for this diagram.</li>
        <li>In the toolbar on the left of the use case diagram click on the Use Case tool {mosimage}.
            <!-- img src="images/ToolUseCase.png" alt="Use Case Tool" / -->
            Now click anywhere inside the diagram. A new use case will be created. Type the
            phrase "Search Timecards" to name the use case. Note that the use case is created
            under the <code>Use Cases</code> package in the containment tree. This is not the
            final location of the use case, but we will move later to the correct location.</li>
        <li>Right click on the use case and give it two stereotypes as discussed earlier: <code>
            FrontEndUseCase</code> and <code>FrontEndApplication</code>.</li>
    </ol>
    <p>
        Now lets create the package <code>org.andromda.timetracker.web.timecardsearch</code>
        which is the final destination of our front-end elements.
    </p>
    <ol>
        <li>Create a package called <code>web</code> under <code>org.andromda.timetracker</code>.</li>
        <li>Create a package called <code>timecardsearch</code> under <code>web</code>.</li>
        <li>Drag the <code>Search Timecards</code> use case under the <code>timecardsearch</code>
            package.</li>
        <li>Create a new class diagram in the <code>timecardsearch</code> package and name it
            <code>Timecard Search Classes</code>.</a></li>
        <li>Now create a class called <code>SearchController</code> under the <code>timecardsearch</code>
            package.</li>
        <li>Right-click on the <code>Search Timecards</code> use case and choose Create Diagram
           &rarr;New Activity Diagram to create an activity diagram. Name it 
            <code>Search Timecards Activity Diagram</code>. This action automatically associates
            the activity diagram to the use case.</li>
        <li>All that is left now is to connect the <code>SearchController</code> to the activity
            diagram. To do this, switch to the Composite-centric view in the explorer pane and
            select unnamed ActivityGraph under the <code>Search Timecards</code> use case.  Go
            to the property panel and change the Context: field to point to the 
            <code>SearchController</code> class.</li>
    </ol>
    <p>
        {mosimage}
        <!-- img src="images/SearchTimecardsAD1.png" alt="Search Timecards Activity Diagram" / -->
    </p>
    <p>
        We are done with the basic structure for the web page. Now let's create the page
        flow on the <code>Search Timecards Activity Diagram</code>. Open this diagram and
        follow the steps below. Use the tool bar on the left to create various elements
        on the diagram. Use the tool tips and the status bar to identify the tool bar icons.</p>
    <ol>
        <li>Create an Initial State at the top using the Initial State tool {mosimage}.
            <!-- img src="images/ToolInitialState" alt="Initial State Tool" / -->
        </li>
        <li>Drop an Action State below it using the Action State tool {mosimage}.
            <!-- img src="images/ToolActionState.png" alt="Action State Tool" / -->
            Go the property panel and type <code>Populate Search
                Screen</code> in the Name field. (Note: Do not enter the name by
            typing it in the diagram, it does not become the name of the action state because
            the UML specification says this figure should show the ????.  AndroMDA requires
            the name field to be used, so enter the name in the property panel.)</li>
        <li>Create a transition from the initial state to the <code>Populate Search Screen</code>
            state. You can use the Transition tool {mosimage}
            <!-- img src="images/ToolTransition.png" alt="Transition Tool" / -->
            for this or select the initial state and use its toolbelt button.</li>
        <li>Drop another action state below <code>Populate Search Screen</code>. Again, go to
            the specification of this state and name it <code>Search Timecards</code>. Since
            this state represents a screen, give it the stereotype of <code>FrontEndView</code>.</li>
        <li>Create a transition from <code>Populate Search Screen</code> to <code>Search Timecards</code>
            and another in the reverse direction. In other words, the use case simply switches
            between the two states - of course, most of the time it stays in the <code>Search Timecards</code>
            state, waiting for use input.</li>
        <li>Now we need to tell AndroMDA about the Search Criteria panel on the search screen.
            In fact, this is a form that will submit 5 parameters to server: submitter, approver,
            status, start date minimum and start date maximum. This is modeled using a trigger
            of type signal on the transition coming out of the front-end view. Follow the steps
            below to specify the trigger.
            <ul>
                <li>Select the transition out of <code>Search Timecards</code> and go to its
                    property panel.</li>
                <li>Find the field called "Trigger" and right click on the empty field, then
                    select New Signal Event.</li>
                <li>Name the signal event <code>search</code>.</li>
                <li>Click on the parameters tab.</li>
                <li>Right click on the Parameters field and select Add to add a new parameter
                    On the Parameter property panel enter <code>submitter</code> as the name 
                    of the parameter and <code>Long</code>
                    as its type (note that it is <code>Long</code>, not <code>long</code>). Now click
                    on the Tagged Values tab and click on the right column and select 
                    <code>@andromda.presentation.web.view.field.type</code> from the drop down
                    menu as the type of the new tagged value.
                    This tagged value tells AndroMDA what type of field <code>submitter</code> is. Since
                    submitter is a drop-down box, i.e. selection, we need to set the value of this tag
                    to <code>select</code> by typing that string in the Value column on the right.</li>
                <li>Return to the Properties tab and add the second parameter called 
                    <code>approver</code> with type of <code>Long</code> by clicking on the 
                    New Parameter tool {mosimage}.
                   <!-- img src="images/ToolNewParameter.png" alt="New Parameter Tool" / -->
                    Again set the tagged value <code>@andromda.presentation.web.view.field.type</code>
                    to <code>select</code>.</li>
                <li>Add the third parameter called <code>status</code> with type of <code>String</code>.
                    Again set the tagged value <code>@andromda.presentation.web.view.field.type</code>
                    to <code>select</code>.</li>
                <li>Add the fourth parameter called <code>startDateMinimum</code> with type of <code>
                    Date</code>. This time set the tagged value <code>@andromda.presentation.web.view.field.calendar</code>
                    to <code>true</code>. This will make sure that you will get a text field for the
                    date along with a calendar widget on its side.</li>
                <li>Add the fifth parameter called <code>startDateMaximum</code> with type of <code>
                    Date</code>. Again set the tagged value <code>@andromda.presentation.web.view.field.calendar</code>
                    to <code>true</code>.</li>
                <li>Return to the Properties tab and click the Parent navigation tool {mosimage}
                   <!-- img src="images/ToolNavigateParent.png" alt="Navigate Parent Tool" / --> to 
                   and check the Parameters field to make sure that you have five parameters 
                   with the correct names and types.</li>
                <li>Here's a trick that you can use to check that you remembered to add all the
                    tagged values with the correct types and values.  ArgoUML maintains a
                    navigation history stack that you can move backwards and forwards through.
                    Click on the Tagged Values tab and then click on the Navigate Back tool 
                    {mosimage}
                    <!-- img src="images/ToolNavigateBack.png" alt="Navigate Back Tool" / -->
                    and review each tagged value to make sure it has the correct type and value.
                    You can tell which element is currently selected by looking at the name
                    next to the Target: label in the upper left hand corner of the property
                    panel.</li>

                <table width="50%" border="0" align="center">
                    <tbody>
                        <tr>
                            <td>submitter</td>
                            <td>Long</td>
                        </tr>
                        <tr>
                            <td>approver</td>
                            <td>Long</td>
                        </tr>
                        <tr>
                            <td>status</td>
                            <td>String</td>
                        </tr>
                        <tr>
                            <td>startDateMinimum</td>
                            <td>Date</td>
                        </tr>
                        <tr>
                            <td>startDateMaximum</td>
                            <td>Date</td>
                        </tr>
                    </tbody>
                </table>
            </ul>
        </li>
    </ol>
    <p>
        We are now almost done with our activity diagram except for one thing. The activity
        diagram still has to call the <code>SearchController</code> to populate the submitter
        and approver drop-downs. To do this we will first specify a method on <code>SearchController</code>
        called <code>populateSearchScreen()</code>. Follow the steps below to add this method:
    </p>
    <ol>
        <li>Select the <code>SearchController</code> class and go to its property panel.</li>
        <li>Click on the New Operation tool.</li>
        <li>Enter <code>populateSearchScreen</code> as the name of the Operation.</li>
        <li>ArgoUML will create a return parameter of type void by default.</li>
        <li>Now add 5 new parameters with same names and types as those you added to the
            trigger above.  The names and types should match exactly because that's how
            AndroMDA knows how to call the controller method.</li>
    </ol>
        <p>
        Now that we have an appropriate controller method, let's call it from the activity
        diagram.</p>
    <ol>
        <li>Select the <code>Populate Search Screen</code> action state go to its property
            panel.</li>
        <li>Click on the Detail tab.</li>
        <li>Right click on the Deferrable Events field and select New&rarr;Call Event.</li>
        <li>Leave the name field blank.</li>
        <li>The Operations drop-down shows the controller methods available to call (since we
            attached the controller to this activity diagram). Select the <code>populateSearchScreen()</code>
            method.</li>
    </ol>

    <p>
        There is just one more thing left. The <code>SearchController</code> needs to be
        able to call the service layer to get the list of users. To add this capability,
        we need to create a dependency from the <code>SearchController</code> to the <code>UserService</code>.</p>
    <p>
        {mosimage}
        <!-- img src="images/SearchControllerToUserService.png" alt="Search Controller To UserService" / -->
    </p>
    <ol>
        <li>Open the Services diagram in the service package.</li>
        <li>From the Explorer pane on the left, drag the <code>SearchController</code> class
            on to the diagram.</li>
        <li>Draw a dependency from <code>SearchController</code> to <code>UserService</code>.</li>
        <li>Save the model.</li>
    </ol>
    <p>
        We have now completely modeled the Search Criteria panel. Please go back to the
        main tutorial page and continue from where you left off
    </p>
</body>
</html>
